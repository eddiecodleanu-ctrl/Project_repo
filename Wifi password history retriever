import subprocess

cmd_command = (
    'netsh wlan show profiles'
)

result = subprocess.run(cmd_command, shell=True, stdout=subprocess.PIPE)
output = result.stdout.decode()

SSID_list = []
Wifi_passwords = {}

for line in output.splitlines():          # split the output into lines
    line = line.strip()                  # remove leading/trailing spaces and \r
    if line and not line.startswith(("Profiles", "Group", "-", "User")) and line != "<None>":
        SSID_list.append(line.removeprefix("All User Profile     : "))

for SSID in SSID_list:
    get_wifi_password_cmd = (
        f'netsh wlan show profile "{SSID}" key=clear | find "Key Content"'
    )
    result2 = subprocess.run(get_wifi_password_cmd, shell=True, stdout=subprocess.PIPE)
    output2 = result2.stdout.decode().strip().removeprefix("Key Content            : ")
    Wifi_passwords[SSID] = output2

for ssid, pswrd in Wifi_passwords.items():
    print(f"\n{ssid}: {pswrd}")
